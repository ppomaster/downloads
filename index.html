<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TV M3U Lite - VOD Profissional</title>
<style>
  body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background: linear-gradient(135deg, #0a174e 30%, #133b8a 100%);
    min-height: 100vh;
    color: #fff;
    margin: 0; padding: 0;
  }
  header {
    margin-top: 30px;
    text-align: center;
  }
  .logo {
    width: 70px; height: 70px;
    margin: 0 auto 25px auto;
    border-radius: 50%;
    background: #1f547c;
    display: flex; align-items: center; justify-content: center;
  }
  .logo::after {
    content: '';
    display: block;
    background: url('https://img.icons8.com/color/80/000000/movie-projector.png') no-repeat center center;
    background-size: 38px 38px;
    width: 38px; height: 38px;
  }
  .nav-circles {
    display: flex;
    justify-content: center;
    gap: 46px;
    margin-bottom: 32px;
  }
  .circle-btn {
    width: 86px; height: 86px;
    background: rgba(255,255,255,0.10);
    border: 4px solid #0b2c65;
    border-radius: 50%;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    cursor: pointer;
    transition: background 0.22s, transform 0.22s;
    box-shadow: 0 2px 14px rgba(0,0,0,0.2);
  }
  .circle-btn.selected, .circle-btn:hover {
    background: rgba(40,180,220,0.27);
    transform: scale(1.07);
    border-color: #29a8ff;
  }
  .circle-btn .icon {
    font-size: 1.7rem;
    margin-bottom: 6px;
  }
  .circle-btn span {
    font-size: 0.93rem; margin-top: 3px; color: #cfe1fc;
    letter-spacing: .01em;
    font-weight: 500;
  }
  .controls-bar {
    margin: 26px auto 10px auto;
    display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;
    max-width: 750px;
  }
  .load-input, .search-input, .category-select {
    background: #fff; color: #0c244b; border: none; border-radius: 5px;
    padding: 8px 10px; font-size: 1rem; margin: 0 2px;
  }
  .action-btn {
    background: #226ccb; color: #fff; border: none; border-radius: 5px;
    font-size: 1rem; padding: 9px 22px; font-weight: bold; cursor: pointer;
    box-shadow: 0 1px 3px rgba(0,0,0,.10);
    transition: background .25s;
  }
  .action-btn:hover { background: #1858a2; }
  .vod-container {
    margin: 24px auto; max-width: 1200px;
  }
  .categories {
    display: flex; flex-direction: column; gap: 36px;
  }
  .category {
    background: rgba(0,14,64,.08);
    border-radius: 12px; padding: 15px 5px 5px 15px;
    box-shadow: 0 2px 7px rgba(18,26,64,0.13);
  }
  .category-header {
    display: flex; justify-content: space-between; align-items: center;
    font-size: 1.16rem; font-weight: 600; color: #20c1fd; margin-bottom: 10px;
  }
  .download-all-btn {
    background: #2e7d32;
    color: #fff; border: none; border-radius: 5px; padding: 5px 17px;
    font-size: .95rem; cursor: pointer; transition: background .22s;
  }
  .download-all-btn:hover { background: #216a27; }
  .items {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(210px,1fr));
    gap: 24px;
  }
  .item-card {
    background: #fff;
    color: #14192d;
    border-radius: 8px;
    display: flex; flex-direction: column;
    box-shadow: 0 2px 8px rgb(0 0 0 / 0.09);
    overflow: hidden;
    transition: transform 0.18s;
    min-height: 385px;
    position: relative;
  }
  .item-img {
    width: 100%; height: 170px; object-fit: cover;
    background: #ececec;
  }
  .item-content {
    padding: 15px 16px 13px 16px;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
  }
  .item-title {
    font-size: 1.08rem; font-weight: 600; margin-bottom: 9px; min-height: 36px; color: #1a315b;
  }
  .item-plot {
    font-size: 0.97rem;
    min-height: 54px; margin-bottom: 10px; color: #11517e;
  }
  .item-meta {
    font-size: 0.88rem; color: #3178a5; margin-bottom: 9px;
  }
  .item-buttons {
    display: flex; gap: 10px; align-items: center; margin-top: auto;
  }
  .btn-watch, .btn-download {
    flex: 1; padding: 7px 12px;
    border: none; border-radius: 6px;
    font-weight: 600; cursor: pointer;
    transition: background-color 0.2s;
    color: #fff; text-align: center; text-decoration: none; display:inline-block;
    font-size: 1rem;
  }
  .btn-watch { background-color: #248bed;}
  .btn-watch:hover { background-color: #144d78; }
  .btn-download { background-color: #2e7d32; }
  .btn-download:hover { background-color: #174f23; }
  .loading, .error {
    text-align: center; font-size: 1.1rem;
    color: #52beef; padding: 28px 10px;
  }
  .error { color: #f76767;}
  @media (max-width: 700px) {
    .nav-circles { gap: 13vw; }
    .items { grid-template-columns: 1fr; }
    .category { padding: 6px 3vw 8px 3vw;}
  }
</style>
</head>
<body>
<header>
  <div class="logo"></div>
  <nav class="nav-circles">
    <div class="circle-btn selected">
      <div class="icon">ðŸ“º</div>
      <span>LIVE TV</span>
    </div>
    <div class="circle-btn"><div class="icon">ðŸ“…</div><span>EPG</span></div>
    <div class="circle-btn"><div class="icon">ðŸŽ¬</div><span>VOD</span></div>
    <div class="circle-btn"><div class="icon">ðŸ“‚</div><span>SERIES</span></div>
  </nav>
</header>
<main>
  <div class="controls-bar">
    <input class="load-input" type="text" id="m3uUrl" placeholder="Cole ou digite o link da lista M3U" size="50"/>
    <button class="action-btn" onclick="carregarLista()">Carregar Lista</button>
    <input type="text" id="searchInput" placeholder="Pesquisar tÃ­tulo..." class="search-input" />
    <button class="search-btn action-btn" onclick="pesquisar()">Buscar</button>
    <select id="categoryFilter" class="category-select" onchange="filtrarPorCategoria()"><option value="all">Todas categorias</option></select>
  </div>
  <div class="vod-container">
    <div id="loading" class="loading" style="display:none;">Carregando lista...</div>
    <div id="categories" class="categories"></div>
  </div>
</main>
<script>
const APIKEY_OMDB = '6cbfb854';
const ITEMS_PER_PAGE = 10;
let allItems = [], categorias = {}, categoriaAtual = 'all';

function carregarLista() {
  const urlInput = document.getElementById('m3uUrl').value.trim();
  if (!urlInput) { alert('Cole o link da lista M3U.'); return; }
  mostrarLoading();
  fetch(urlInput)
    .then(resp => {
      if (!resp.ok) throw new Error(`Erro ao carregar: ${resp.status} ${resp.statusText}`);
      return resp.text();
    })
    .then(text => processarM3U(text))
    .catch(erro => mostrarErro(erro.message));
}

function processarM3U(text) {
  allItems = [];
  categorias = {};
  let lines = text.split('\n'), currentItem = null, pendingFetch = [];
  for (let line of lines) {
    line = line.trim();
    if (line.startsWith('#EXTINF:')) { currentItem = parseExtInf(line); }
    else if (currentItem && line && !line.startsWith('#') && (line.startsWith('http') || line.startsWith('https'))) {
      currentItem.url = line;
      if (!categorias[currentItem.categoria]) categorias[currentItem.categoria] = [];
      categorias[currentItem.categoria].push(currentItem);
      allItems.push(currentItem);
      pendingFetch.push(adicionarMetaOMDb(currentItem));
      currentItem = null;
    }
  }
  Promise.all(pendingFetch).then(() => {
    preencherFiltroCategorias();
    filtrarPorCategoria();
    ocultarLoading();
  });
}

// Busca dados no OMDb
function adicionarMetaOMDb(item) {
  // Para VOD deve ser filme, entÃ£o tentamos buscar primeiro pelo nome
  return fetch(`https://www.omdbapi.com/?apikey=${APIKEY_OMDB}&t=${encodeURIComponent(item.nome)}`)
    .then(r => r.json())
    .then(info => {
      if (info.Response === "True") {
        if (info.Poster && info.Poster.startsWith("http")) item.capa = info.Poster;
        item.sinopse = info.Plot || "";
        item.ano = info.Year || "";
        item.genero = info.Genre || "";
        item.atores = info.Actors || "";
        item.nota = info.imdbRating || "";
      } else {
        item.sinopse = "";
        item.ano = "";
        item.capa = item.capa || "";
        item.genero = "";
        item.atores = "";
        item.nota = "";
      }
    }).catch(()=>{});
}

function parseExtInf(line) {
  let item = { categoria: 'VOD', nome: '', url: '', capa: '', sinopse: '', ano: '' };
  let gtStart = line.indexOf('group-title="');
  if (gtStart !== -1) {
    let gtEnd = line.indexOf('"', gtStart + 13);
    if (gtEnd !== -1) item.categoria = line.substring(gtStart + 13, gtEnd);
  }
  let logoStart = line.indexOf('tvg-logo="');
  if (logoStart !== -1) {
    let logoEnd = line.indexOf('"', logoStart + 9);
    if (logoEnd !== -1) item.capa = line.substring(logoStart + 9, logoEnd);
  }
  let lastComma = line.lastIndexOf(',');
  if (lastComma !== -1) item.nome = line.substring(lastComma + 1).trim();
  return item;
}

function preencherFiltroCategorias() {
  let select = document.getElementById('categoryFilter');
  while (select.options.length > 1) select.remove(1);
  Object.keys(categorias).sort().forEach(cat => {
    let option = document.createElement('option');
    option.value = cat;
    option.textContent = cat;
    select.appendChild(option);
  });
}

function filtrarPorCategoria() {
  categoriaAtual = document.getElementById('categoryFilter').value;
  renderizarCategorias();
}

function renderizarCategorias() {
  let container = document.getElementById('categories');
  container.innerHTML = '';
  let cats = categoriaAtual === 'all' ? Object.keys(categorias) : [categoriaAtual];

  cats.forEach(cat => {
    let items = categorias[cat];
    if (!items || items.length === 0) return;

    let catDiv = document.createElement('section');
    catDiv.className = 'category';

    let header = document.createElement('div');
    header.className = 'category-header';
    header.textContent = `${cat} (${items.length})`;

    let btnBaixarTodos = document.createElement('button');
    btnBaixarTodos.className = 'download-all-btn';
    btnBaixarTodos.textContent = 'Baixar tudo';
    btnBaixarTodos.onclick = () => baixarTodos(items);
    header.appendChild(btnBaixarTodos);
    catDiv.appendChild(header);

    let itemsDiv = document.createElement('div');
    itemsDiv.className = 'items';
    let limit = Math.min(items.length, ITEMS_PER_PAGE);
    for (let i = 0; i < limit; i++) itemsDiv.appendChild(criarItemCard(items[i]));
    if (items.length > ITEMS_PER_PAGE) {
      let loadMore = document.createElement('div');
      loadMore.style.textAlign = 'center';
      let btnLoadMore = document.createElement('button');
      btnLoadMore.textContent = `Carregar mais (${items.length - ITEMS_PER_PAGE})`;
      btnLoadMore.className = 'download-all-btn';
      btnLoadMore.onclick = () => carregarMaisItens(btnLoadMore, itemsDiv, items, ITEMS_PER_PAGE);
      loadMore.appendChild(btnLoadMore);
      catDiv.appendChild(loadMore);
    }
    catDiv.appendChild(itemsDiv);
    container.appendChild(catDiv);
  });
}

function criarItemCard(item) {
  let card = document.createElement('article');
  card.className = 'item-card';

  let img = document.createElement('img');
  img.className = 'item-img';
  img.src = item.capa || 'https://via.placeholder.com/300x150?text=Sem+Capa';
  img.alt = item.nome;
  card.appendChild(img);

  let content = document.createElement('div');
  content.className = 'item-content';
  let title = document.createElement('h3');
  title.className = 'item-title';
  title.textContent = item.nome + (item.ano ? ' (' + item.ano + ')' : '');
  content.appendChild(title);

  let plot = document.createElement('div');
  plot.className = 'item-plot';
  plot.textContent = item.sinopse || "Sinopse indisponÃ­vel";
  content.appendChild(plot);

  if (item.atores || item.genero || item.nota) {
    let meta = document.createElement('div');
    meta.className = 'item-meta';
    meta.innerHTML = 
      (item.genero ? `<b>GÃªnero:</b> ${item.genero} &nbsp;` : '') + 
      (item.nota ? `<b>IMDb:</b> ${item.nota} &nbsp;` : '') +
      (item.atores ? `<b>Atores:</b> ${item.atores}` : '');
    content.appendChild(meta);
  }

  let btns = document.createElement('div');
  btns.className = 'item-buttons';

  let btnAssistir = document.createElement('a');
  btnAssistir.href = item.url;
  btnAssistir.target = '_blank';
  btnAssistir.textContent = 'Assistir';
  btnAssistir.className = 'btn-watch';
  btns.appendChild(btnAssistir);

  let btnDownload = document.createElement('button');
  btnDownload.textContent = 'Download';
  btnDownload.className = 'btn-download';
  btnDownload.onclick = () => baixarItem(item.url, item.nome);
  btns.appendChild(btnDownload);

  content.appendChild(btns);
  card.appendChild(content);

  return card;
}

function carregarMaisItens(button, container, items, offset) {
  let limite = Math.min(items.length, offset + ITEMS_PER_PAGE);
  for (let i = offset; i < limite; i++) container.appendChild(criarItemCard(items[i]));
  if (limite >= items.length) button.parentElement.remove();
  else {
    button.textContent = `Carregar mais (${items.length - limite})`;
    button.onclick = () => carregarMaisItens(button, container, items, limite);
  }
}

function pesquisar() {
  let termo = document.getElementById('searchInput').value.toLowerCase().trim();
  if (!termo) { filtrarPorCategoria(); return; }
  let resultados = [];
  Object.values(categorias).forEach(catItems => {
    resultados.push(...catItems.filter(item => item.nome.toLowerCase().includes(termo)));
  });
  let grouped = resultados.reduce((acc, item) => ((acc[item.categoria] = acc[item.categoria] || []).push(item), acc), {});
  let container = document.getElementById('categories'); container.innerHTML = '';
  if (resultados.length === 0) {
    container.innerHTML = '<div class="error">Nenhum resultado encontrado</div>'; return;
  }
  for (const [cat, items] of Object.entries(grouped)) {
    let catDiv = document.createElement('section');
    catDiv.className = 'category';
    let header = document.createElement('div');
    header.className = 'category-header';
    header.textContent = `${cat} (${items.length})`;
    catDiv.appendChild(header);
    let itemsDiv = document.createElement('div');
    itemsDiv.className = 'items';
    items.forEach(item => itemsDiv.appendChild(criarItemCard(item)));
    catDiv.appendChild(itemsDiv);
    container.appendChild(catDiv);
  }
}

function baixarItem(url, nome) {
  let a = document.createElement('a');
  a.href = url;
  a.download = nome || 'arquivo';
  a.target = '_blank';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}
function baixarTodos(items) {
  if (!confirm(`Deseja baixar todos os ${items.length} itens desta categoria?`)) return;
  items.forEach(item => baixarItem(item.url, item.nome));
}
function mostrarLoading() {
  document.getElementById('loading').style.display = 'block';
  document.getElementById('categories').innerHTML = '';
}
function ocultarLoading() {
  document.getElementById('loading').style.display = 'none';
}
function mostrarErro(msg) {
  const container = document.getElementById('loading');
  container.innerHTML = `<div class="error">${msg}</div>`;
  container.style.display = 'block';
}
</script>
</body>
</html>
